# TODO: To be deleted

#上传选手代码（原有：更新，无：插入）
mutation UpsertCode1(
  $code: String!
  $update_time: timestamptz!
  $team_id: uuid!
  $contest_id: uuid!
  $code_type: String!
) {
  insert_contest_code_one(
    object: {
      code1: $code
      code1_update_time: $update_time
      team_id: $team_id
      contest_id: $contest_id
      code_type1: $code_type
    }
    on_conflict: {
      constraint: contest_code_pkey
      update_columns: [code1, code1_update_time, code_type1]
    }
  ) {
    code1_update_time
  }
}

mutation UpsertCode2(
  $code: String!
  $update_time: timestamptz!
  $team_id: uuid!
  $contest_id: uuid!
  $code_type: String!
) {
  insert_contest_code_one(
    object: {
      code2: $code
      code2_update_time: $update_time
      team_id: $team_id
      contest_id: $contest_id
      code_type2: $code_type
    }
    on_conflict: {
      constraint: contest_code_pkey
      update_columns: [code2, code2_update_time, code_type2]
    }
  ) {
    code2_update_time
  }
}

mutation UpsertCode3(
  $code: String!
  $update_time: timestamptz!
  $team_id: uuid!
  $contest_id: uuid!
  $code_type: String!
) {
  insert_contest_code_one(
    object: {
      code3: $code
      code3_update_time: $update_time
      team_id: $team_id
      contest_id: $contest_id
      code_type3: $code_type
    }
    on_conflict: {
      constraint: contest_code_pkey
      update_columns: [code3, code3_update_time, code_type3]
    }
  ) {
    code3_update_time
  }
}

mutation UpsertCode4(
  $code: String!
  $update_time: timestamptz!
  $team_id: uuid!
  $contest_id: uuid!
  $code_type: String!
) {
  insert_contest_code_one(
    object: {
      code4: $code
      code4_update_time: $update_time
      team_id: $team_id
      contest_id: $contest_id
      code_type4: $code_type
    }
    on_conflict: {
      constraint: contest_code_pkey
      update_columns: [code4, code4_update_time, code_type4]
    }
  ) {
    code4_update_time
  }
}

mutation UpsertCode5(
  $code: String!
  $update_time: timestamptz!
  $team_id: uuid!
  $contest_id: uuid!
  $code_type: String!
) {
  insert_contest_code_one(
    object: {
      code5: $code
      code5_update_time: $update_time
      team_id: $team_id
      contest_id: $contest_id
      code_type5: $code_type
    }
    on_conflict: {
      constraint: contest_code_pkey
      update_columns: [code5, code5_update_time, code_type5]
    }
  ) {
    code5_update_time
  }
}

# 以下是新的代码管理接口，使用contest_team_code和contest_team_player表

# 主要操作对象：contest_team_code表

# 增
mutation AddCode(
  $team_id: uuid!
  $code_name: String!
  $language: String!
  $compile_status: String
) {
  insert_contest_team_code_one(
    object: {
      team_id: $team_id
      code_name: $code_name
      language: $language
      compile_status: $compile_status
    }
  ) {
    code_id
  }
}

# 删
mutation DeleteCode($code_id: uuid!) {
  delete_contest_team_code_by_pk(code_id: $code_id) {
    code_id
  }
}

# 改
mutation UpdateCodeName($code_id: uuid!, $code_name: String!) {
  update_contest_team_code_by_pk(
    pk_columns: { code_id: $code_id }
    _set: { code_name: $code_name }
  ) {
    code_id
  }
}

# 查
subscription GetCodes($team_id: uuid!) {
  contest_team_code(
    order_by: { created_at: desc }
    where: { team_id: { _eq: $team_id } }
  ) {
    code_id
    code_name
    language
    compile_status
    created_at
  }
}

# 主要操作对象：contest_team_player表

# 增
mutation AddTeamPlayer($team_id: uuid!, $player: String!) {
  insert_contest_team_player_one(
    object: { team_id: $team_id, player: $player }
  ) {
    player
  }
}

# 删：删除队伍时级联删除

# 改
mutation UpdateTeamPlayer(
  $team_id: uuid!
  $player: String!
  $code_id: uuid!
  $role: String!
) {
  update_contest_team_player_by_pk(
    pk_columns: { team_id: $team_id, player: $player }
    _set: { code_id: $code_id, role: $role }
  ) {
    player
  }
}

# 查
subscription GetTeamPlayers($team_id: uuid!) {
  contest_team_player(where: { team_id: { _eq: $team_id } }) {
    player
    player_code {
      code_name
      language
      created_at
    }
    role
  }
}
